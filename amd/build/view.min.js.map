{"version":3,"sources":["../src/view.js"],"names":["define","$","Templates","notification","ajax","Str","ModalFactory","ModalEvents","ACTIONS","VIEW_FEEDBACK","DECLINE_FEEDBACK","UNDO_DECLINE","threesixtyid","refreshParticipantsList","promises","call","methodname","args","when","then","response","render","done","compiledSource","js","replaceWith","runTemplateJS","fail","exception","view","id","registerEvents","prototype","click","e","preventDefault","statusid","data","name","declineTemplatePromise","titlePromise","get_string","title","create","body","large","type","types","SAVE_CANCEL","modal","show","getRoot","on","hidden","destroy","save","val","reason","trim","declinereason"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD code for the frequently used comments chooser for the marking guide grading form.\n *\n * @module     mod_threesixo/view\n * @class      view\n * @package    core\n * @copyright  2016 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events'\n], function($, Templates, notification, ajax, Str, ModalFactory, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{VIEW_FEEDBACK: string, DECLINE_FEEDBACK: string}}\n     */\n    var ACTIONS = {\n        VIEW_FEEDBACK: '[data-action=\"view-feedback\"]',\n        DECLINE_FEEDBACK: '[data-action=\"decline-feedback\"]',\n        UNDO_DECLINE: '[data-action=\"undo-decline\"]'\n    };\n\n    var threesixtyid;\n\n    /**\n     * Refresh the list of participants.\n     */\n    function refreshParticipantsList() {\n        // Refresh the list of participants thru AJAX.\n        var promises = ajax.call([\n            {methodname: 'mod_threesixo_data_for_participant_list', args: {threesixtyid: threesixtyid}}\n        ]);\n        $.when(promises[0]).then(function(response) {\n            return Templates.render('mod_threesixo/list_participants', response);\n\n        }).done(function(compiledSource, js) {\n            $('[data-region=\"participantlist\"]').replaceWith(compiledSource);\n            Templates.runTemplateJS(js);\n\n        }).fail(notification.exception);\n    }\n\n    var view = function(id) {\n        threesixtyid = id;\n        this.registerEvents();\n    };\n\n    view.prototype.registerEvents = function() {\n        $(ACTIONS.DECLINE_FEEDBACK).click(function(e) {\n            e.preventDefault();\n\n            var statusid = $(this).data('statusid');\n            var name = $(this).data('name');\n            var context = {\n                statusid: statusid,\n                name: name\n            };\n            var declineTemplatePromise = Templates.render('mod_threesixo/decline_feedback', context);\n            var titlePromise = Str.get_string('declinefeedback', 'mod_threesixo');\n\n            $.when(titlePromise).then(function(title) {\n                return ModalFactory.create({\n                    title: title,\n                    body: declineTemplatePromise,\n                    large: true,\n                    type: ModalFactory.types.SAVE_CANCEL\n                });\n            }).done(function(modal) {\n                // Display the dialogue.\n                modal.show();\n\n                // On hide handler.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy modal when hidden.\n                    modal.destroy();\n                });\n\n                modal.getRoot().on(ModalEvents.save, function() {\n                    var statusid = $(\"#decline-statusid\").val();\n                    var reason = $(\"#decline-reason\").val().trim();\n                    var data = {\n                        statusid: statusid,\n                        declinereason: reason\n                    };\n\n                    var method = 'mod_threesixo_decline_feedback';\n\n                    // Refresh the list of questions thru AJAX.\n                    var promises = ajax.call([\n                        {methodname: method, args: data}\n                    ]);\n                    promises[0].done(function() {\n                        refreshParticipantsList();\n                    }).fail(notification.exception);\n                });\n            }).fail(notification.exception);\n        });\n\n        $(ACTIONS.UNDO_DECLINE).click(function(e) {\n            e.preventDefault();\n\n            var statusid = $(this).data('statusid');\n            var data = {\n                statusid: statusid\n            };\n\n            var method = 'mod_threesixo_undo_decline';\n\n            // Refresh the list of questions thru AJAX.\n            var promises = ajax.call([\n                {methodname: method, args: data}\n            ]);\n            promises[0].done(function() {\n                refreshParticipantsList();\n            }).fail(notification.exception);\n        });\n    };\n\n    return view;\n});\n"],"file":"view.min.js"}